#
# CRI
#
- name: Downloading cri-containerd
  stat:
    path: /srv/k8s/download/cri-containerd-{{ containerd_version }}.linux-amd64.tar.gz
  register: cri_containerd

- debug: msg="{{ cri_containerd }}"

- get_url:
    url: https://storage.googleapis.com/cri-containerd-release/cri-containerd-{{ containerd_version }}.linux-amd64.tar.gz
    dest: /srv/k8s/download
    mode: '0644'
  when: cri_containerd.stat.exists == false


#
# CRICTL
#
- name: Downloading crictl
  stat:
    path: /srv/k8s/download/crictl-{{ crictl_version }}-linux-amd64.tar.gz
  register: crictl
- get_url:
    url: https://github.com/kubernetes-sigs/cri-tools/releases/download/{{ crictl_version }}/crictl-{{ crictl_version }}-linux-amd64.tar.gz
    dest: /srv/k8s/download
    mode: '0644'
  when: crictl.stat.exists == false


#
# RUNC
#
- name: Downloading runc
  stat:
    path: /srv/k8s/download/runc.amd64
  register: runc
- get_url:
    url: https://github.com/opencontainers/runc/releases/download/{{ runc_version }}/runc.amd64
    dest: /srv/k8s/download
    mode: '0644'
  when: runc.stat.exists == false

#
# CNI-PLUGIN
#
- name: Downloading cni-plugins
  stat:
    path: /srv/k8s/download/cni-plugins-linux-amd64-{{ cni_plugins }}.tgz
  register: cni
- get_url:
    url: https://github.com/containernetworking/plugins/releases/download/{{ cni_plugins }}/cni-plugins-linux-amd64-{{ cni_plugins }}.tgz
    dest: /srv/k8s/download
    mode: '0644'
  when: cni.stat.exists == false
      

#
# CONTAINERD
#
- name: Downloading containerd
  stat:
    path: containerd-{{ containerd_version }}.linux-amd64.tar.gz
  register: containerd
- get_url:
    url: https://github.com/containerd/containerd/releases/download/v{{ containerd_version }}/containerd-{{ containerd_version }}.linux-amd64.tar.gz
    dest: /srv/k8s/download
    mode: '0644'
  when: containerd.stat.exists == false


