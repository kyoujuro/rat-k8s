### THIS FILE IS GENERATED BY setup.rb ###
### Template file is playbook/setup_templates/net_bridge_static-route_iptables.yaml.template
- name: Insert/Update netplan
  blockinfile:
    dest: /etc/netplan/50-vagrant.yaml
    insertafter: '172.16.2*'
    regexp: '172.16.2*'
    state: present
    block: |2
            routes:
              - to: 10.244.1.0/24
                via: 172.16.4.31
                metric: 100
                on-link: true
              - to: 10.244.2.0/24
                via: 172.16.4.32
                metric: 100
                on-link: true
              - to: 10.244.3.0/24
                via: 172.16.4.33
                metric: 100
                on-link: true
              - to: 10.244.21.0/24
                via: 172.16.4.61
                metric: 100
                on-link: true
              - to: 10.244.23.0/24
                via: 172.16.4.63
                metric: 100
                on-link: true

- shell: netplan apply


- name: Set iptables for nat
  shell: iptables -t nat -A POSTROUTING -s 10.244.22.0/24 -j MASQUERADE

- shell: iptables-save